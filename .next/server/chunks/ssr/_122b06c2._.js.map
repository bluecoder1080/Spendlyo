{"version":3,"sources":["../../../../node_modules/zustand/esm/react.mjs","../../../../node_modules/zustand/esm/vanilla.mjs","../../../../src/components/ui/input.tsx","../../../../src/store/useMessageStore.ts","../../../../src/components/chat/chat-interface.tsx","../../../../node_modules/lucide-react/src/icons/send.ts"],"sourcesContent":["import React from 'react';\nimport { createStore } from 'zustand/vanilla';\n\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity) {\n  const slice = React.useSyncExternalStore(\n    api.subscribe,\n    React.useCallback(() => selector(api.getState()), [api, selector]),\n    React.useCallback(() => selector(api.getInitialState()), [api, selector])\n  );\n  React.useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  const api = createStore(createState);\n  const useBoundStore = (selector) => useStore(api, selector);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = ((createState) => createState ? createImpl(createState) : createImpl);\n\nexport { create, useStore };\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const getInitialState = () => initialState;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const api = { setState, getState, getInitialState, subscribe };\n  const initialState = state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = ((createState) => createState ? createStoreImpl(createState) : createStoreImpl);\n\nexport { createStore };\n","import * as React from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nexport interface InputProps\r\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\r\n\r\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\r\n  ({ className, type, ...props }, ref) => {\r\n    return (\r\n      <input\r\n        type={type}\r\n        className={cn(\r\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\r\n          className\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nInput.displayName = \"Input\"\r\n\r\nexport { Input }\r\n","import { create } from 'zustand'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { Message, Role } from '@/lib/types-chat'\r\n\r\ninterface MessageState {\r\n  messages: Message[]\r\n  isLoading: boolean\r\n  fetchMessages: () => Promise<void>\r\n  sendMessage: (content: string, role?: Role) => Promise<void>\r\n}\r\n\r\nexport const useMessageStore = create<MessageState>((set, get) => ({\r\n  messages: [],\r\n  isLoading: false,\r\n  fetchMessages: async () => {\r\n    set({ isLoading: true })\r\n    const supabase = createClient()\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    \r\n    if (!user) {\r\n      set({ messages: [], isLoading: false })\r\n      return\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from('messages')\r\n      .select('*')\r\n      .order('created_at', { ascending: true }) // Oldest first for chat\r\n\r\n    if (error) {\r\n      console.error('Error fetching messages:', error)\r\n      set({ isLoading: false })\r\n      return\r\n    }\r\n\r\n    set({ messages: data as Message[], isLoading: false })\r\n  },\r\n\r\n  sendMessage: async (content, role = 'user') => {\r\n    const supabase = createClient()\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    \r\n    if (!user) return\r\n\r\n    // Optimistic Update\r\n    const optimisticId = crypto.randomUUID()\r\n    const optimisticMessage: Message = {\r\n      id: optimisticId,\r\n      user_id: user.id,\r\n      content,\r\n      role,\r\n      created_at: new Date().toISOString(),\r\n    }\r\n\r\n    set((state) => ({ messages: [...state.messages, optimisticMessage] }))\r\n\r\n    const { data, error } = await supabase\r\n      .from('messages')\r\n      .insert({\r\n        user_id: user.id,\r\n        content,\r\n        role,\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('Error sending message:', error)\r\n      // Revert optimistic update? Or just let it fail silently/show toast.\r\n      // For now, simpler to just refetch or rely on sync.\r\n      // We will remove the optimistic message if it fails, or replace it with real one.\r\n      set((state) => ({ \r\n          messages: state.messages.filter(m => m.id !== optimisticId) \r\n      }))\r\n      return\r\n    }\r\n\r\n    if (data) {\r\n        // Replace optimistic with real\r\n        set((state) => ({\r\n            messages: state.messages.map(m => m.id === optimisticId ? (data as Message) : m)\r\n        }))\r\n    }\r\n  },\r\n}))\r\n","\"use client\"\r\n\r\nimport { useEffect, useRef, useState } from \"react\"\r\nimport { useMessageStore } from \"@/store/useMessageStore\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Send } from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nexport function ChatInterface() {\r\n  const { messages, fetchMessages, sendMessage, isLoading } = useMessageStore()\r\n  const [inputValue, setInputValue] = useState(\"\")\r\n  const bottomRef = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => {\r\n    fetchMessages()\r\n  }, [fetchMessages])\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' })\r\n  }, [messages])\r\n\r\n  const handleSend = async () => {\r\n    if (!inputValue.trim()) return\r\n    await sendMessage(inputValue)\r\n    setInputValue(\"\")\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-[600px] border rounded-lg bg-background shadow-sm\">\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {isLoading && messages.length === 0 && (\r\n             <div className=\"text-center text-muted-foreground text-sm\">Loading chat...</div>\r\n        )}\r\n        {messages.length === 0 && !isLoading && (\r\n            <div className=\"text-center text-muted-foreground text-sm flex flex-col items-center justify-center h-full opacity-50\">\r\n                <p>No messages yet.</p>\r\n                <p>Start tracking your expenses!</p>\r\n            </div>\r\n        )}\r\n        {messages.map((msg) => (\r\n          <div\r\n            key={msg.id}\r\n            className={cn(\r\n              \"flex w-full mb-2\",\r\n              msg.role === \"user\" ? \"justify-end\" : \"justify-start\"\r\n            )}\r\n          >\r\n            <div\r\n              className={cn(\r\n                \"max-w-[80%] rounded-2xl px-4 py-2 text-sm\",\r\n                msg.role === \"user\"\r\n                  ? \"bg-primary text-primary-foreground rounded-br-none\"\r\n                  : \"bg-muted text-foreground rounded-bl-none\"\r\n              )}\r\n            >\r\n              {msg.content}\r\n              <div className={cn(\"text-[10px] mt-1 opacity-70\", msg.role === 'user' ? \"text-primary-foreground/80\" : \"text-muted-foreground\")}>\r\n                  {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n      <div className=\"p-4 border-t flex gap-2\">\r\n        <Input\r\n          value={inputValue}\r\n          onChange={(e) => setInputValue(e.target.value)}\r\n          onKeyDown={(e) => e.key === \"Enter\" && handleSend()}\r\n          placeholder=\"New expense... (e.g. 'Lunch 350')\"\r\n          className=\"flex-1\"\r\n        />\r\n        <Button size=\"icon\" onClick={handleSend} disabled={!inputValue.trim()}>\r\n          <Send className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z',\n      key: '1ffxy3',\n    },\n  ],\n  ['path', { d: 'm21.854 2.147-10.94 10.939', key: '12cjpa' }],\n];\n\n/**\n * @component @name Send\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTQuNTM2IDIxLjY4NmEuNS41IDAgMCAwIC45MzctLjAyNGw2LjUtMTlhLjQ5Ni40OTYgMCAwIDAtLjYzNS0uNjM1bC0xOSA2LjVhLjUuNSAwIDAgMC0uMDI0LjkzN2w3LjkzIDMuMThhMiAyIDAgMCAxIDEuMTEyIDEuMTF6IiAvPgogIDxwYXRoIGQ9Im0yMS44NTQgMi4xNDctMTAuOTQgMTAuOTM5IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/send\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Send = createLucideIcon('send', __iconNode);\n\nexport default Send;\n"],"names":[],"mappings":"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","ignoreList":[0,1,5]}